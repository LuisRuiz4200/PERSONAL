package vistas;

import javax.swing.*;

import com.toedter.calendar.JDateChooser;
import java.awt.event.ActionListener;
import java.util.Date;
import java.awt.event.ActionEvent;
import clases.*;
import utils.Tool;
import arreglos.*;
import javax.swing.border.TitledBorder;

@SuppressWarnings("serial")
public class FrmPago extends JInternalFrame implements ActionListener{
	private JLabel lblCodigo;
	private JTextField txtCodigo;
	private JTextField txtAbono;
	private JLabel lblMonto;
	private JLabel lblCliente;
	private JComboBox <Object> cboCliente;
	private JDateChooser dcFecha;
	private JLabel lblFecha;
	private JButton btnAgregar;
	private JButton btnModificar;
	private ArregloPago arrPago;
	private JComboBox <Object> cboMedioPago;
	private JLabel lblMedioPago;
	private JPanel panlePago;
	private JPanel panel_1;
	
	
	
	public static void main(String [] args) {
		
		FrmPago form = new FrmPago();
		form.setVisible(true);
		
	}
	
	public FrmPago() {
		
		setTitle("Pagos realizados");
		setBounds(100,100,609,457);
		//setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);
		
		setClosable(true);
		setMaximizable(true);
		setIconifiable(true);
		
		this.getContentPane().setLayout(null);
		
		arrPago = new ArregloPago();
		
		btnAgregar = new JButton("Agregar");
		btnAgregar.addActionListener(this);
		btnAgregar.setBounds(368, 317, 89, 23);
		getContentPane().add(btnAgregar);
		
		btnModificar = new JButton("Modificar");
		btnModificar.addActionListener(this);
		btnModificar.setBounds(494, 317, 89, 23);
		getContentPane().add(btnModificar);
		
		panel = new JPanel();
		panel.setBorder(new TitledBorder(null, "PAGO", TitledBorder.LEADING, TitledBorder.TOP, null, null));
		panel.setBounds(10, 11, 457, 112);
		getContentPane().add(panel);
		panel.setLayout(null);
		
		lblCodigo = new JLabel("CODIGO");
		lblCodigo.setBounds(10, 18, 46, 14);
		panel.add(lblCodigo);
		
		txtCodigo = new JTextField();
		txtCodigo.setBounds(10, 36, 86, 20);
		panel.add(txtCodigo);
		txtCodigo.setColumns(10);
		
		txtAbono = new JTextField();
		txtAbono.setBounds(10, 80, 86, 20);
		panel.add(txtAbono);
		txtAbono.setColumns(10);
		
		lblMonto = new JLabel("MONTO");
		lblMonto.setBounds(10, 62, 46, 14);
		panel.add(lblMonto);
		
		lblCliente = new JLabel("CLIENTE");
		lblCliente.setBounds(117, 17, 77, 14);
		panel.add(lblCliente);
		
		cboCliente = new JComboBox<Object>();
		cboCliente.setBounds(117, 34, 160, 22);
		panel.add(cboCliente);
		
		dcFecha = new JDateChooser();
		dcFecha.setBounds(301, 36, 124, 20);
		panel.add(dcFecha);
		
		lblFecha = new JLabel("FECHA");
		lblFecha.setBounds(301, 18, 46, 14);
		panel.add(lblFecha);
		
		cboMedioPago = new JComboBox <Object>();
		cboMedioPago.setBounds(117, 79, 138, 22);
		panel.add(cboMedioPago);
		
		lblMedioPago = new JLabel("MEDIO DE PAGO");
		lblMedioPago.setBounds(117, 62, 104, 14);
		panel.add(lblMedioPago);
		
		panel_1 = new JPanel();
		panel_1.setBounds(10, 134, 457, 119);
		getContentPane().add(panel_1);
		
		arranque();
		
	}
	public void actionPerformed(ActionEvent e) {
		if (e.getSource() == btnModificar) {
			actionPerformedBtnModificar(e);
		}
		if (e.getSource() == btnAgregar) {
			actionPerformedBtnAgregar(e);
		}
	}
	protected void actionPerformedBtnAgregar(ActionEvent e) {
		
		String codigo = leerCodigo();
		String cliente = leerCliente();
		String fecha = leerFecha ();
		double monto = leerMonto();
		String medioPago = leerMedioPago();
		
		
		arrPago.adicionar(new Pago(codigo,cliente,monto,fecha,medioPago));
		Tool.mensajeExito(this, "Registro Exitoso");
		arrPago.gabrarPago();
		
	}


	protected void actionPerformedBtnModificar(ActionEvent e) {
	}
	
	//Metodos de ingreso
	
	private String leerMedioPago() {
		return cboMedioPago.getSelectedItem().toString();
	}
	
	private double leerMonto() {
		return Double.parseDouble(txtAbono.getText());
	}

	private String leerFecha() {
		return Tool.sdf.format(dcFecha.getDate());
	}

	private String leerCliente() {
		String res = null;
		
		ArregloCliente arrCliente = new ArregloCliente();
		
		for (int i=0;i<arrCliente.tamaño();i++) {
			if(arrCliente.obtener(i).getNom_cliente().equals(cboCliente.getSelectedItem())) {
				res = arrCliente.obtener(i).getId_cliente();
			}
		}
		return res;
	}

	private String leerCodigo() {
		return txtCodigo.getText();
	}
	
	//Metodos adicionales
	
	void arranque() {
		
		llenarCboCliente();
		cargarMedioPago();
		txtCodigo.setText("" + correlativo());
		dcFecha.setDate(new Date());
	}
	
	void llenarCboCliente (){
		
		ArregloCliente arrCliente  = new ArregloCliente();
		
		cboCliente.removeAllItems();
		
		for (int i=0;i<arrCliente.tamaño();i++) {
			 cboCliente.addItem(arrCliente.obtener(i).getId_cliente());
		}
	}
	
	int correlativo() {
		if(arrPago.tamaño()==0) {
			return 1;
		}else {
			return Integer.parseInt(arrPago.obtener(arrPago.tamaño()-1).getId_pago())+1;
		}
	}
	
	void limpiar () {
		txtCodigo.setText("" + correlativo());
		cboCliente.setSelectedIndex(-1);
		dcFecha.setDate(new Date());
		txtAbono.setText("");
		
	}
	
	void cargarMedioPago() {
		
		String[] medioPago = {"EFECTIVO","YAPE","PLIN","TRANFERENCIA"};
		
		cboMedioPago.setModel(new DefaultComboBoxModel(medioPago));
		
	}
}
