package vistas;

import javax.swing.*;

import com.toedter.calendar.JDateChooser;
import java.awt.event.ActionListener;
import java.util.Date;
import java.awt.event.ActionEvent;
import clases.*;
import utils.Tool;
import arreglos.*;

@SuppressWarnings("serial")
public class FrmPago extends JInternalFrame implements ActionListener{
	private JLabel lblCodigo;
	private JTextField txtCodigo;
	private JTextField txtAbono;
	private JLabel lblMonto;
	private JLabel lblCliente;
	private JComboBox <Object> cboCliente;
	private JDateChooser dcFecha;
	private JLabel lblFecha;
	private JButton btnAgregar;
	private JButton btnModificar;
	private ArregloPago arrPago;
	private JComboBox cboMedioPago;
	private JLabel lblMedioPago;
	
	
	
	public static void main(String [] args) {
		
		FrmPago form = new FrmPago();
		form.setVisible(true);
		
	}
	
	public FrmPago() {
		
		setTitle("Pagos realizados");
		setBounds(100,100,523,198);
		//setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);
		
		setClosable(true);
		setMaximizable(true);
		setIconifiable(true);
		
		this.getContentPane().setLayout(null);
		
		arrPago = new ArregloPago();
		
		lblCodigo = new JLabel("CODIGO");
		lblCodigo.setBounds(10, 11, 46, 14);
		getContentPane().add(lblCodigo);
		
		txtCodigo = new JTextField();
		txtCodigo.setBounds(10, 29, 86, 20);
		getContentPane().add(txtCodigo);
		txtCodigo.setColumns(10);
		
		txtAbono = new JTextField();
		txtAbono.setColumns(10);
		txtAbono.setBounds(10, 73, 86, 20);
		getContentPane().add(txtAbono);
		
		lblMonto = new JLabel("MONTO");
		lblMonto.setBounds(10, 55, 46, 14);
		getContentPane().add(lblMonto);
		
		lblCliente = new JLabel("CLIENTE");
		lblCliente.setBounds(117, 10, 46, 14);
		getContentPane().add(lblCliente);
		
		cboCliente = new JComboBox<Object>();
		cboCliente.setBounds(117, 27, 160, 22);
		getContentPane().add(cboCliente);
		
		dcFecha = new JDateChooser();
		dcFecha.setBounds(301, 29, 124, 20);
		getContentPane().add(dcFecha);
		
		lblFecha = new JLabel("FECHA");
		lblFecha.setBounds(301, 11, 46, 14);
		getContentPane().add(lblFecha);
		
		btnAgregar = new JButton("Agregar");
		btnAgregar.addActionListener(this);
		btnAgregar.setBounds(232, 114, 89, 23);
		getContentPane().add(btnAgregar);
		
		btnModificar = new JButton("Modificar");
		btnModificar.addActionListener(this);
		btnModificar.setBounds(358, 114, 89, 23);
		getContentPane().add(btnModificar);
		
		cboMedioPago = new JComboBox();
		cboMedioPago.setBounds(117, 72, 138, 22);
		getContentPane().add(cboMedioPago);
		
		lblMedioPago = new JLabel("MEDIO DE PAGO");
		lblMedioPago.setBounds(117, 55, 104, 14);
		getContentPane().add(lblMedioPago);
		
		arranque();
		
	}
	public void actionPerformed(ActionEvent e) {
		if (e.getSource() == btnModificar) {
			actionPerformedBtnModificar(e);
		}
		if (e.getSource() == btnAgregar) {
			actionPerformedBtnAgregar(e);
		}
	}
	protected void actionPerformedBtnAgregar(ActionEvent e) {
		
		String codigo = leerCodigo();
		String cliente = leerCliente();
		String fecha = leerFecha ();
		double monto = leerMonto();
		String medioPago = leerMedioPago();
		
		
		arrPago.adicionar(new Pago(codigo,cliente,monto,fecha,medioPago));
		Tool.mensajeExito(this, "Registro Exitoso");
		arrPago.gabrarPago();
		
	}


	protected void actionPerformedBtnModificar(ActionEvent e) {
	}
	
	//Metodos de ingreso
	
	private String leerMedioPago() {
		return null;
	}
	
	private double leerMonto() {
		return Double.parseDouble(txtAbono.getText());
	}

	private String leerFecha() {
		return Tool.sdf.format(dcFecha.getDate());
	}

	private String leerCliente() {
		String res = null;
		
		ArregloCliente arrCliente = new ArregloCliente();
		
		for (int i=0;i<arrCliente.tamaño();i++) {
			if(arrCliente.obtener(i).getNom_cliente().equals(cboCliente.getSelectedItem())) {
				res = arrCliente.obtener(i).getId_cliente();
			}
		}
		return res;
	}

	private String leerCodigo() {
		return txtCodigo.getText();
	}
	
	//Metodos adicionales
	
	void arranque() {
		
		llenarCboCliente();
		txtCodigo.setText("" + correlativo());
		dcFecha.setDate(new Date());
	}
	
	void llenarCboCliente (){
		
		ArregloCliente arrCliente  = new ArregloCliente();
		
		cboCliente.removeAllItems();
		
		for (int i=0;i<arrCliente.tamaño();i++) {
			 cboCliente.addItem(arrCliente.obtener(i).getId_cliente());
		}
	}
	
	int correlativo() {
		if(arrPago.tamaño()==0) {
			return 1;
		}else {
			return Integer.parseInt(arrPago.obtener(arrPago.tamaño()-1).getId_pago())+1;
		}
	}
	
	void limpiar () {
		txtCodigo.setText("" + correlativo());
		cboCliente.setSelectedIndex(-1);
		dcFecha.setDate(new Date());
		txtAbono.setText("");
		
	}
	
	void cargarMedioPago() {
		
		String[] medioPago = {"EFECTIVO","YAPE","PLIN","TRANFERENCIA"};
		
		cboMedioPago.setSelectedIndex(0);
		
		cboMedioPago.setModel(new ComboBoxModel(meedioPago));
		
	}
}
